#- hosts: all
#  tasks:
    - name: install prerequests
      become: yes
      apt: name={{item}} state=present
      with_items:
      - git
      - cmake
      - libgoogle-glog-dev
      - libgflags-dev
      - libatlas-base-dev
      - libeigen3-dev
      - libsuitesparse-dev

    - name: add ceres ppa
      become: yes
      apt_repository:
        repo: 'ppa:mikepurvis/ceres'

    - name: install ceres
      become: yes
      apt: name=libceres-dev state=present update_cache=yes

    - name: checkout opencv
      git:
        repo: https://github.com/opencv/opencv.git
        dest: ~/src/github.com/opencv/opencv

    - name: checkout opencv_contrib
      git:
        repo: https://github.com/opencv/opencv_contrib.git
        dest: ~/src/github.com/opencv/opencv_contrib

    - name: cmake opencv
      command:
        sh -c 'mkdir build && cd build && cmake .. -DOPENCV_EXTRA_MODULES_PATH=~/src/github.com/opencv/opencv_contrib/modules -DGFLAGS_LIBRARY=/usr/lib/x86_64-linux-gnu/libgflags.so -DGFLAGS_INCLUDE_DIR=/usr/include -DOPENCV_ENABLE_NONFREE=ON -DBUILD_opencv_dnn=OFF'
        chdir=~/src/github.com/opencv/opencv
        creates=~/src/github.com/opencv/opencv/build/Makefile

    - name: compile opencv
      command:
        make -j12
        chdir="{{ansible_user_dir}}/src/github.com/opencv/opencv/build"

    - name: install opencv
      become: yes
      make:
        chdir: "{{ansible_user_dir}}/src/github.com/opencv/opencv/build"
        target: install
